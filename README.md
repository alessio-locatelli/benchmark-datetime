# benchmark-datetime

Compare:

- Python 3.11.6 [`datetime`](https://docs.python.org/3/library/datetime.html)
- [python-dateutil](https://github.com/dateutil/dateutil) 2.8.2
- [arrow](https://github.com/arrow-py/arrow/) 1.3.0
- [pendulum](https://github.com/sdispater/pendulum) 2.1.2
- [udatetime](https://github.com/freach/udatetime) 0.0.17
- [pydantic](https://github.com/pydantic/pydantic) 2.5.2 (used only in benchmarks where we parse an argument)
- [pandas](https://pandas.pydata.org/) 2.1.4 (used only in benchmarks where we parse an argument)

There are three types of benchmarks or three types of actions you can do in your code:

- Manipulating datetime, date, duration objects.
- Parsing (for example, converting a string to an object).
- Dumping (for example, converting an object to a string).

## How to setup

1. Install [Poetry](https://python-poetry.org/).
2. Activate the virtual environment and install dependencies: `poetry shell && poetry install`.

Some packages (for example, `udatetime`) may require additional dependencies for building from source.
Read the documentation for specific packages if the installation fails.

Suggestions and contributions are welcome.

## How to run

```sh
pytest benchmark/ --benchmark-group-by=func --benchmark-histogram
```

## Histogram

### Parsing

![](./benchmark_histogram/parse/benchmark_20231215_184107-test_parse_utc_from_iso_8601.svg)
![](./benchmark_histogram/parse/benchmark_20231215_184107-test_parse_utc_from_rfc_3339.svg)
![](./benchmark_histogram/parse/benchmark_20231215_184107-test_parse_utc_from_iso_8601_duration.svg)
![](./benchmark_histogram/parse/benchmark_20231215_184107-test_parse_utc_from_timestamp.svg)

### Manipulating

![](./benchmark_histogram/manipulate/benchmark_20231215_184107-test_now_utc.svg)
![](./benchmark_histogram/manipulate/benchmark_20231215_184107-test_now_local.svg)
![](./benchmark_histogram/manipulate/benchmark_20231215_184107-test_isoweekday.svg)
![](./benchmark_histogram/manipulate/benchmark_20231215_184107-test_add_timedelta.svg)
![](./benchmark_histogram/manipulate/benchmark_20231215_184107-test_find_next_saturday.svg)
![](./benchmark_histogram/manipulate/benchmark_20231215_184107-test_timedelta_to_seconds.svg)

### Dumping

![](./benchmark_histogram/dump/benchmark_20231215_184107-test_convert_dt_to_isoformat_string.svg)

## Results summary

If performance is important:

- Use Python `datetime` module for manipulating dates and times.
- Use Python `datetime` module, `udatetime` or `Pydantic` for parsing.

`pendulum` and `arrow` can be several times slower. Use third-party packages if you need additional functionality for manipulating dates, and a possible performance overhead can be ignored, and you are not going to implement these helper functions with a standard library.

## Results

```bash
------------------------------------------------------------------------------ benchmark 'test_add_timedelta': 4 tests ------------------------------------------------------------------------------
Name (time in us)                    Min                Max               Mean            StdDev             Median               IQR            Outliers  OPS (Kops/s)            Rounds  Iterations
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_add_timedelta[python]        1.3490 (1.0)       7.6917 (1.0)       1.4110 (1.0)      0.1323 (1.0)       1.3963 (1.0)      0.0213 (1.0)     2584;6552      708.7109 (1.0)      167477           3
test_add_timedelta[pendulum]     10.3120 (7.64)     47.0150 (6.11)     10.8037 (7.66)     1.1555 (8.73)     10.6380 (7.62)     0.1180 (5.53)    1466;3616       92.5608 (0.13)      54225           1
test_add_timedelta[dateutil]     10.3380 (7.66)     39.7470 (5.17)     10.7148 (7.59)     0.5828 (4.40)     10.6330 (7.62)     0.1170 (5.49)    1572;3474       93.3292 (0.13)      64375           1
test_add_timedelta[arrow]        20.3660 (15.10)    77.0320 (10.01)    21.0037 (14.89)    1.6644 (12.58)    20.7370 (14.85)    0.1520 (7.13)     956;2222       47.6107 (0.07)      26361           1
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_add_timedelta.svg
---------------------------------------------------------------------------------------- benchmark 'test_convert_dt_to_isoformat_string': 4 tests ---------------------------------------------------------------------------------------
Name (time in ns)                                         Min                    Max                  Mean              StdDev                Median                IQR              Outliers  OPS (Kops/s)            Rounds  Iterations
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_convert_dt_to_isoformat_string[udatetime]       777.8988 (1.0)       6,120.4017 (1.0)        818.0044 (1.0)      170.3275 (1.0)        782.8989 (1.0)       3.3993 (1.0)      4781;21756    1,222.4873 (1.0)      118666          10
test_convert_dt_to_isoformat_string[python]        2,051.4999 (2.64)     28,320.0061 (4.63)     2,164.6858 (2.65)     249.4734 (1.46)     2,142.4785 (2.74)     32.0142 (9.42)      2146;5810      461.9608 (0.38)     185564           2
test_convert_dt_to_isoformat_string[pendulum]      2,205.0226 (2.83)     16,761.0124 (2.74)     2,311.4490 (2.83)     201.8184 (1.18)     2,294.5169 (2.93)     32.9746 (9.70)      2597;6568      432.6291 (0.35)     170563           2
test_convert_dt_to_isoformat_string[arrow]         2,616.0269 (3.36)     15,418.9765 (2.52)     2,751.9504 (3.36)     225.5039 (1.32)     2,736.0511 (3.49)     46.0423 (13.54)      370;1110      363.3786 (0.30)      44799           1
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_convert_dt_to_isoformat_string.svg
-------------------------------------------------------------------------------------------- benchmark 'test_find_next_saturday': 4 tests -------------------------------------------------------------------------------------------
Name (time in ns)                             Min                        Max                   Mean                 StdDev                 Median                 IQR            Outliers  OPS (Kops/s)            Rounds  Iterations
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_find_next_saturday[python]          559.8005 (1.0)           4,929.9968 (1.0)         584.2228 (1.0)          37.5932 (1.0)         582.7984 (1.0)       10.3028 (1.0)     1223;2114    1,711.6759 (1.0)      105108          10
test_find_next_saturday[dateutil]     10,747.9864 (19.20)    10,571,338.9930 (>1000.0)  11,305.5694 (19.35)    41,281.9243 (>1000.0)  11,065.0435 (18.99)    110.0125 (10.68)      1;2668       88.4520 (0.05)      65450           1
test_find_next_saturday[pendulum]     13,954.9957 (24.93)        60,777.9948 (12.33)    14,484.7475 (24.79)     1,328.7359 (35.35)    14,303.0193 (24.54)    127.0673 (12.33)   1465;2937       69.0381 (0.04)      51180           1
test_find_next_saturday[arrow]        19,232.9753 (34.36)        80,008.9911 (16.23)    19,883.2828 (34.03)     1,646.2207 (43.79)    19,639.0320 (33.70)    154.0175 (14.95)   1295;2376       50.2935 (0.03)      37087           1
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_find_next_saturday.svg
---------------------------------------------------------------------------------- benchmark 'test_isoweekday': 4 tests ----------------------------------------------------------------------------------
Name (time in ns)                   Min                   Max                Mean             StdDev              Median               IQR            Outliers  OPS (Mops/s)            Rounds  Iterations
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_isoweekday[python]        119.7704 (1.0)        573.1796 (1.0)      121.6565 (1.0)       4.1967 (1.0)      121.3001 (1.0)      0.5600 (1.0)     1014;1860        8.2199 (1.0)       79599         100
test_isoweekday[udatetime]     120.0764 (1.00)       763.3577 (1.33)     124.2177 (1.02)     12.2643 (2.92)     123.3331 (1.02)     1.5641 (2.79)    1730;3089        8.0504 (0.98)     199005          39
test_isoweekday[pendulum]      213.6095 (1.78)     1,160.6076 (2.02)     220.8737 (1.82)     19.8079 (4.72)     219.2607 (1.81)     1.9133 (3.42)    1768;7553        4.5275 (0.55)     188252          23
test_isoweekday[arrow]         251.4978 (2.10)     1,821.8008 (3.18)     260.6666 (2.14)     22.4513 (5.35)     259.6993 (2.14)     3.3004 (5.89)     715;6236        3.8363 (0.47)     190986          10
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_isoweekday.svg
------------------------------------------------------------------------------------------- benchmark 'test_now_local': 4 tests -------------------------------------------------------------------------------------------
Name (time in ns)                     Min                     Max                   Mean                StdDev                 Median                   IQR            Outliers  OPS (Kops/s)            Rounds  Iterations
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_now_local[udatetime]        173.9099 (1.0)          567.1702 (1.0)         176.5986 (1.0)          6.5460 (1.0)         175.9699 (1.0)          0.6007 (1.0)     1116;6941    5,662.5587 (1.0)       55424         100
test_now_local[python]           396.8307 (2.28)       3,519.3322 (6.21)        406.9732 (2.30)        46.3643 (7.08)        401.4194 (2.28)         3.4973 (5.82)    2976;7305    2,457.1642 (0.43)     192790          12
test_now_local[pendulum]       7,815.0188 (44.94)    376,570.9698 (663.95)    8,396.3771 (47.54)    2,932.4838 (447.98)    8,108.9674 (46.08)      167.9873 (279.65)  1330;3380      119.0990 (0.02)      46839           1
test_now_local[arrow]         50,179.0200 (288.53)   529,977.0273 (934.42)   53,502.1291 (302.96)   9,773.2622 (>1000.0)  51,448.0053 (292.37)   1,527.0198 (>1000.0)  596;1364       18.6908 (0.00)      10386           1
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_now_local.svg
---------------------------------------------------------------------------------------- benchmark 'test_now_utc': 5 tests ----------------------------------------------------------------------------------------
Name (time in ns)                  Min                    Max                  Mean                StdDev                Median                IQR             Outliers  OPS (Kops/s)            Rounds  Iterations
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_now_utc[udatetime]       171.8797 (1.0)         488.3797 (1.0)        174.5653 (1.0)          6.7096 (1.0)        173.8599 (1.0)       0.5902 (1.0)      1106;2267    5,728.5156 (1.0)       56136         100
test_now_utc[python]          380.3289 (2.21)      4,348.2481 (8.90)       389.4367 (2.23)        33.7869 (5.04)       386.6638 (2.22)      2.6679 (4.52)     1506;8234    2,567.8116 (0.45)     195696          12
test_now_utc[dateutil]        473.3040 (2.75)      4,174.8979 (8.55)       502.1188 (2.88)       100.4709 (14.97)      490.3006 (2.82)     13.7952 (23.37)    2560;5087    1,991.5604 (0.35)     171439          10
test_now_utc[arrow]         3,448.9785 (20.07)    53,130.0320 (108.79)   3,760.6391 (21.54)    1,007.3907 (150.14)   3,623.0194 (20.84)    93.0158 (157.59)   2947;6388      265.9122 (0.05)     131442           1
test_now_utc[pendulum]      3,704.9758 (21.56)    36,585.9596 (74.91)    3,897.6576 (22.33)      397.1240 (59.19)    3,844.9652 (22.12)    63.0389 (106.80)   2190;6411      256.5643 (0.04)     126968           1
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_now_utc.svg
------------------------------------------------------------------------------------------ benchmark 'test_parse_utc_from_iso_8601': 7 tests -------------------------------------------------------------------------------------------
Name (time in ns)                                   Min                     Max                   Mean                StdDev                 Median                 IQR             Outliers  OPS (Kops/s)            Rounds  Iterations
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_parse_utc_from_iso_8601[python]           136.5400 (1.0)          436.7402 (1.0)         140.4359 (1.0)          6.8306 (1.0)         138.1501 (1.0)        5.7800 (1.0)      1194;1107    7,120.6850 (1.0)       68475         100
test_parse_utc_from_iso_8601[pydantic]         538.5705 (3.94)       5,833.8628 (13.36)       574.3733 (4.09)        66.3651 (9.72)        568.2897 (4.11)      15.8574 (2.74)     1492;9320    1,741.0281 (0.24)     199920           7
test_parse_utc_from_iso_8601[udatetime]        974.8037 (7.14)       4,634.8083 (10.61)       994.1939 (7.08)        56.6976 (8.30)        989.2043 (7.16)       6.6007 (1.14)     1443;8839    1,005.8400 (0.14)     183521           5
test_parse_utc_from_iso_8601[pandas]         5,438.9820 (39.83)     25,202.9859 (57.71)     5,725.7905 (40.77)      461.3637 (67.54)     5,668.0292 (41.03)     89.9890 (15.57)    1663;3044      174.6484 (0.02)      80900           1
test_parse_utc_from_iso_8601[dateutil]      11,646.0142 (85.29)     41,175.9829 (94.28)    12,046.2991 (85.78)      717.1430 (104.99)   11,951.0223 (86.51)    119.9660 (20.76)    1090;2300       83.0130 (0.01)      47405           1
test_parse_utc_from_iso_8601[pendulum]      20,013.0162 (146.57)    60,591.9631 (138.74)   20,650.3434 (147.04)   1,227.4325 (179.70)   20,442.9962 (147.98)   184.0526 (31.84)    1014;2779       48.4253 (0.01)      31079           1
test_parse_utc_from_iso_8601[arrow]         73,242.0012 (536.41)   185,812.0086 (425.45)   75,161.6337 (535.20)   5,772.5941 (845.10)   74,120.9951 (536.53)   461.9942 (79.93)     153;1137       13.3047 (0.00)       8915           1
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_parse_utc_from_iso_8601.svg
----------------------------------------------------------------------------------------- benchmark 'test_parse_utc_from_iso_8601_duration': 3 tests -----------------------------------------------------------------------------------------
Name (time in ns)                                           Min                    Max                   Mean                StdDev                 Median                 IQR            Outliers  OPS (Kops/s)            Rounds  Iterations
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_parse_utc_from_iso_8601_duration[pydantic]        433.4986 (1.0)       2,137.6502 (1.0)         449.7577 (1.0)         25.7619 (1.0)         447.5005 (1.0)        5.7509 (1.0)     1070;3213    2,223.4192 (1.0)       99692          20
test_parse_utc_from_iso_8601_duration[pandas]       12,575.9980 (29.01)    43,620.9957 (20.41)    13,023.9104 (28.96)      986.3576 (38.29)    12,875.0107 (28.77)    116.9974 (20.34)   1386;3019       76.7819 (0.03)      45266           1
test_parse_utc_from_iso_8601_duration[pendulum]     13,382.9890 (30.87)    41,585.9977 (19.45)    13,939.4961 (30.99)    1,076.8766 (41.80)    13,775.0176 (30.78)    151.0489 (26.27)    839;2269       71.7386 (0.03)      30479           1
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_parse_utc_from_iso_8601_duration.svg
-------------------------------------------------------------------------------------------- benchmark 'test_parse_utc_from_rfc_3339': 6 tests ---------------------------------------------------------------------------------------------
Name (time in ns)                                    Min                     Max                    Mean                StdDev                  Median                   IQR            Outliers  OPS (Kops/s)            Rounds  Iterations
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_parse_utc_from_rfc_3339[python]            549.6026 (1.0)        3,110.6989 (1.0)          563.7502 (1.0)         43.4381 (1.0)          560.2022 (1.0)          4.4995 (1.0)     1123;7345    1,773.8352 (1.0)      160205          10
test_parse_utc_from_rfc_3339[pydantic]        1,852.9827 (3.37)      20,935.0255 (6.73)       2,042.5637 (3.62)       294.3784 (6.78)       2,023.0073 (3.61)        72.9924 (16.22)   1593;3356      489.5808 (0.28)     145879           1
test_parse_utc_from_rfc_3339[udatetime]       2,985.0053 (5.43)      21,501.0368 (6.91)       3,164.1009 (5.61)       267.9031 (6.17)       3,146.9972 (5.62)        63.0389 (14.01)   1433;2406      316.0455 (0.18)     127357           1
test_parse_utc_from_rfc_3339[pandas]         35,754.9870 (65.06)     96,090.0215 (30.89)     36,736.7390 (65.16)    1,920.8068 (44.22)     36,410.9874 (65.00)      289.9906 (64.45)    860;1481       27.2207 (0.02)      17864           1
test_parse_utc_from_rfc_3339[pendulum]       54,803.9679 (99.72)     95,741.9979 (30.78)     56,076.9909 (99.47)    1,721.7001 (39.64)     55,663.9861 (99.36)      419.0370 (93.13)    862;1273       17.8326 (0.01)      12826           1
test_parse_utc_from_rfc_3339[arrow]         208,572.0189 (379.50)   252,687.0230 (81.23)    212,439.6286 (376.83)   4,002.1950 (92.14)    210,925.0054 (376.52)   2,066.5029 (459.28)    222;257        4.7072 (0.00)       1187           1
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_parse_utc_from_rfc_3339.svg
--------------------------------------------------------------------------------------- benchmark 'test_parse_utc_from_timestamp': 5 tests ---------------------------------------------------------------------------------------
Name (time in ns)                                   Min                    Max                  Mean              StdDev                Median                IQR             Outliers  OPS (Kops/s)            Rounds  Iterations
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_parse_utc_from_timestamp[python]          165.2102 (1.0)         393.4000 (1.0)        167.3231 (1.0)        7.2466 (1.0)        166.4500 (1.0)       0.4796 (1.0)      1299;2994    5,976.4622 (1.0)       56042         100
test_parse_utc_from_timestamp[udatetime]       190.7209 (1.15)      1,191.6808 (3.03)       194.5037 (1.16)      13.1687 (1.82)       193.5614 (1.16)      1.4412 (3.00)     1194;6226    5,141.2912 (0.86)     194025          25
test_parse_utc_from_timestamp[pydantic]      2,007.0001 (12.15)    38,111.0003 (96.88)    2,145.7641 (12.82)    303.5554 (41.89)    2,124.9871 (12.77)    58.0330 (121.00)   2709;5515      466.0345 (0.08)     198690           1
test_parse_utc_from_timestamp[pendulum]      4,407.0184 (26.68)    34,025.9867 (86.49)    4,617.7176 (27.60)    512.0495 (70.66)    4,559.9882 (27.40)    68.0448 (141.87)   1980;6163      216.5572 (0.04)     124363           1
test_parse_utc_from_timestamp[arrow]         5,698.0061 (34.49)    24,948.9676 (63.42)    5,946.0619 (35.54)    468.0330 (64.59)    5,890.0332 (35.39)    85.9727 (179.25)   1314;2700      168.1785 (0.03)      76829           1
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_parse_utc_from_timestamp.svg
------------------------------------------------------------------------------ benchmark 'test_substract_timedelta': 4 tests -------------------------------------------------------------------------------
Name (time in us)                          Min                Max               Mean            StdDev             Median               IQR             Outliers  OPS (Kops/s)            Rounds  Iterations
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_substract_timedelta[python]        1.4393 (1.0)      12.0417 (1.0)       1.5117 (1.0)      0.1326 (1.0)       1.4960 (1.0)      0.0217 (1.0)      2883;6828      661.4863 (1.0)      176148           3
test_substract_timedelta[pendulum]     10.5230 (7.31)     50.2200 (4.17)     10.9402 (7.24)     0.7782 (5.87)     10.8360 (7.24)     0.1201 (5.54)     1448;3562       91.4057 (0.14)      62961           1
test_substract_timedelta[dateutil]     10.5950 (7.36)     43.5130 (3.61)     11.0045 (7.28)     0.6374 (4.81)     10.9200 (7.30)     0.1170 (5.40)     1500;3217       90.8717 (0.14)      65194           1
test_substract_timedelta[arrow]        20.4440 (14.20)    50.0460 (4.16)     21.0082 (13.90)    1.2334 (9.30)     20.8120 (13.91)    0.1680 (7.75)     1128;2624       47.6005 (0.07)      34908           1
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_substract_timedelta.svg
----------------------------------------------------------------------------------- benchmark 'test_timedelta_to_seconds': 2 tests ----------------------------------------------------------------------------------
Name (time in ns)                            Min                   Max                Mean             StdDev              Median                IQR             Outliers  OPS (Mops/s)            Rounds  Iterations
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
test_timedelta_to_seconds[python]       249.8887 (1.0)      2,042.9984 (1.0)      262.2200 (1.0)      28.8935 (1.08)     260.0007 (1.0)      10.9430 (1.43)     3064;3199        3.8136 (1.0)      199481          18
test_timedelta_to_seconds[pendulum]     267.5006 (1.07)     2,177.5631 (1.07)     279.9287 (1.07)     26.7897 (1.0)      276.1262 (1.06)      7.6288 (1.0)      2756;3189        3.5723 (0.94)     199722          16
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Generated histogram: /home/sam/projects/benchmark-datetime/benchmark_20231215_184107-test_timedelta_to_seconds.svg
Legend:
  Outliers: 1 Standard Deviation from Mean; 1.5 IQR (InterQuartile Range) from 1st Quartile and 3rd Quartile.
  OPS: Operations Per Second, computed as 1 / Mean
```
